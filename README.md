# NeuroEnglish Tutor

> **Telegram-бот с искусственным интеллектом для изучения английского языка с персонализированными упражнениями и интеллектуальной обратной связью**

[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![aiogram 3.10.0](https://img.shields.io/badge/aiogram-3.10.0-blue.svg)](https://docs.aiogram.dev/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

##  Описание

**NeuroEnglish Tutor** — это интеллектуальный Telegram-бот, предназначенный для помощи русскоязычным пользователям в изучении английского языка через интерактивные уроки, адаптивные упражнения и обратную связь на основе искусственного интеллекта. Бот использует **GigaChat API** от Сбера для предоставления персонализированного опыта обучения, отслеживания прогресса и поддержания мотивации через геймификацию.

###  Основные возможности

-  **Интерактивные уроки** — Структурированные объяснения грамматических тем с примерами
-  **Адаптивные упражнения** — Персонализированные задания по грамматике, лексике и переводу
-  **AI-ассистент** — Задавайте любые вопросы по английскому и получайте подробные объяснения
-  **Проверка текста** — Отправьте текст на английском для анализа ошибок и рекомендаций
-  **Отслеживание прогресса** — Следите за точностью, слабыми темами и серией занятий
-  **Геймификация** — Ежедневные серии и мотивационные сообщения
-  **Динамическая сложность** — Упражнения адаптируются под ваш уровень

##  Архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                     Telegram Bot (aiogram)                  │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │   main.py    │  │  database.py │  │learning_engine│      │
│  │   (Router)   │──│  (SQLite)    │  │   .py        │       │
│  │              │  │              │  │  (Логика)    │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
│         │                                      │            │
│         └──────────────────┬──────────────────┘             │
│                            │                                │
│                   ┌────────▼────────┐                       │
│                   │  openai_api.py  │                       │
│                   │ (GigaChat API)  │                       │
│                   └─────────────────┘                       │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │  GigaChat API   │
                   │   (Sber AI)     │
                   └─────────────────┘
```

##  Быстрый старт

### Требования

- Python 3.8 или выше
- Токен Telegram-бота (от [@BotFather](https://t.me/botfather))
- Учетные данные GigaChat API (с [GigaChat](https://developers.sber.ru/gigachat))

### Установка

1. **Клонируйте репозиторий:**
   ```bash
   git clone https://github.com/Teralyglack/Neuroticher.git
   cd neuroenglish-tutor
   ```

2. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```

3. **Настройте переменные окружения:**
   
   Создайте файл `.env` в корне проекта:
   ```env
   BOT_TOKEN=ваш_токен_telegram_бота
   GIGACHAT_CLIENT_ID=ваш_client_id_gigachat
   GIGACHAT_CLIENT_SECRET=ваш_client_secret_gigachat
   GIGACHAT_MODEL=GigaChat
   ```

4. **Запустите бота:**
   ```bash
   python main.py
   ```

   Вы должны увидеть:
   ```
   ====================================================
    NeuroEnglish Tutor запущен!
    База данных: 
    GigaChat: настроен
   ====================================================
   ```

## Руководство пользователя

### Доступные команды

- `/start` — Запуск бота и отображение главного меню
- `/menu` — Открыть главное меню
- `/reset` — Очистить контекст диалога с AI

### Основные функции

#### 1. Уроки
Интерактивные уроки по основным грамматическим темам:
- Present Simple / Past Simple
- Артикли (a/an/the)
- Модальные глаголы (can/should/must)
- И многое другое...

Каждый урок включает:
- Понятные объяснения
- 5+ примеров с переводом
- Частые ошибки
- Практические упражнения

#### 2.  Упражнения
Три типа адаптивных упражнений:
- **Грамматика** — Заполнение пропусков, правильные формы
- **Лексика** — Выбор слов, устойчивые выражения
- **Перевод** — Перевод с русского на английский

Бот автоматически подстраивает сложность под ваш уровень!

#### 3. Вопрос AI
Задавайте любые вопросы по английскому:
- Уточнение грамматических правил
- Разница между похожими словами
- Использование конкретных фраз
- И многое другое...

#### 4. Проверка текста
Отправьте текст на английском (2-10 предложений) и получите:
- Общую оценку (0-10)
- Анализ ошибок (грамматика, лексика, пунктуация, стиль)
- Улучшенную версию текста
- Персональные рекомендации

#### 5. Статистика
Отслеживайте свой прогресс:
- Текущий уровень (beginner/intermediate/advanced)
- Всего выполнено упражнений
- Процент точности
- Серия дней подряд
- Слабые темы для фокусированной практики

## Структура проекта

```
neuroenglish-tutor/
│
├── main.py                  # Точка входа и обработчики бота
├── database.py              # Операции с базой данных SQLite
├── learning_engine.py       # Логика обучения и оценки
├── openai_api.py           # Интеграция с GigaChat API
├── requirements.txt         # Зависимости Python
├── .env                     # Переменные окружения (не в репозитории)
├── english_tutor.db        # База данных SQLite (создается автоматически)
└── README.md               # Этот файл
```

### Основные компоненты

#### `main.py`
- Инициализация и настройка бота
- Обработчики команд и callback-запросов
- FSM (конечный автомат) для диалоговых потоков
- Inline-клавиатуры меню

#### `database.py`
- Управление пользователями (создание, получение, обновление)
- Отслеживание истории упражнений
- Расчет статистики
- Система отслеживания серий

#### `learning_engine.py`
- Алгоритм определения уровня
- Оценка и нормализация ответов
- Рекомендации по темам
- Расчет сложности
- Мотивационные сообщения

#### `openai_api.py`
- OAuth2 аутентификация GigaChat
- Управление контекстом диалога
- Генерация упражнений
- Проверка текста
- Ответы на вопросы

## Схема базы данных

### Таблица пользователей
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    telegram_id INTEGER UNIQUE NOT NULL,
    username TEXT,
    level TEXT DEFAULT 'beginner',
    goal TEXT DEFAULT 'general',
    total_exercises INTEGER DEFAULT 0,
    correct_answers INTEGER DEFAULT 0,
    accuracy REAL DEFAULT 0.0,
    weak_topics TEXT DEFAULT '[]',
    vocabulary_size INTEGER DEFAULT 0,
    streak_days INTEGER DEFAULT 0,
    last_exercise_date TEXT,
    last_active TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Таблица истории упражнений
```sql
CREATE TABLE exercise_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    exercise_type TEXT,
    topic TEXT,
    question TEXT,
    user_answer TEXT,
    correct_answer TEXT,
    is_correct INTEGER,
    difficulty REAL,
    time_spent INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE
);
```

### Таблица планов обучения
```sql
CREATE TABLE learning_plans (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    daily_goal INTEGER DEFAULT 5,
    focus_topics TEXT DEFAULT '[]',
    progress_percentage REAL DEFAULT 0.0,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE
);
```

## Интеграция с AI

### GigaChat API

Бот использует **GigaChat** от Сбербанка для AI-функций:

- **OAuth2 аутентификация**: Автоматическое управление токенами с обработкой истечения
- **Контекст диалога**: Поддержка истории разговора для каждого пользователя
- **Структурированные ответы**: Генерация упражнений в формате JSON
- **Система резервных упражнений**: Предопределенные упражнения при недоступности API

#### Конфигурация API

```python
# Настройки в файле .env
GIGACHAT_CLIENT_ID=ваш_client_id
GIGACHAT_CLIENT_SECRET=ваш_client_secret
GIGACHAT_MODEL=GigaChat  # или GigaChat-Pro
```

#### Ключевые особенности
- Автоматическое обновление токенов
- Контекстно-зависимые ответы
- HTML-форматированный вывод (совместимый с Telegram)
- Обработка ошибок и логирование

##  Алгоритм обучения

### Система прогрессии уровней

```python
def get_user_level(accuracy: float, total_exercises: int) -> str:
    if total_exercises < 10:
        return "beginner"
    if accuracy >= 0.85 and total_exercises >= 50:
        return "advanced"
    if accuracy >= 0.70 and total_exercises >= 20:
        return "intermediate"
    return "beginner"
```

**Уровни:**
- **Beginner (Начинающий)**: < 10 упражнений или точность < 70%
- **Intermediate (Средний)**: ≥ 20 упражнений и точность ≥ 70%
- **Advanced (Продвинутый)**: ≥ 50 упражнений и точность ≥ 85%

### Динамическая настройка сложности

Бот автоматически регулирует сложность упражнений на основе:
- Процента точности пользователя
- Общего количества выполненных упражнений
- Тенденций последних результатов

```python
def calculate_difficulty(user_stats: Dict) -> float:
    accuracy = user_stats.get("accuracy", 0.5)
    total = user_stats.get("total_exercises", 0)
    
    if total < 5:
        return 0.3  # Легкие упражнения для новичков
    if accuracy >= 0.9:
        return min(0.9, 0.55 + (total / 120.0))  # Постепенное усложнение
    if accuracy <= 0.5:
        return max(0.2, 0.45 - (total / 250.0))  # Упрощение
    return 0.5  # Средняя сложность
```

### Система серий (Streaks)

Ежедневные серии поощряют регулярную практику:
-  3+ дня: "Отлично! Уже несколько дней подряд!"
-  7+ дней: "Огонь! Неделя подряд — супер!"
-  14+ дней: "Вау! 14+ дней подряд — это железная дисциплина!"

**Логика обновления серии:**
- Упражнение сегодня → серия сохраняется
- Упражнение вчера → серия +1
- Пропуск > 1 дня → серия сбрасывается до 1

## Система оценки ответов

### Нормализация ответов

Перед сравнением ответов бот выполняет нормализацию:

```python
def normalize_answer(text: str) -> str:
    text = text.strip().lower()
    # Удаление лишних знаков препинания (кроме апострофов в словах)
    text = re.sub(r"(?!\b\w+'\w+\b)[^\w\s']", " ", text)
    # Удаление множественных пробелов
    text = re.sub(r"\s+", " ", text).strip()
    return text
```

### Частичное совпадение

Бот проверяет частичное совпадение ответов (≥60% общих слов):

```python
def _check_partial_match(user: str, correct: str) -> bool:
    u = set(user.split())
    c = set(correct.split())
    return (len(u.intersection(c)) / len(c)) >= 0.6
```

### Обратная связь

Система предоставляет три типа обратной связи:
-  **Правильный ответ**: Мотивационные сообщения
-  **Частичное совпадение**: Указание на небольшие неточности
-  **Неправильный ответ**: Поддержка и объяснение

## Разработка

### Стиль кода

Проект следует лучшим практикам Python:
- Аннотации типов для ясности кода
- Async/await для неблокирующих операций
- Четкое разделение ответственности
- Всесторонняя обработка ошибок

### Добавление новых функций

1. **Новые темы уроков**: Отредактируйте `kb_lessons()` в `main.py`
2. **Типы упражнений**: Расширьте логику оценки в `learning_engine.py`
3. **AI-промпты**: Измените системные промпты в `openai_api.py`

### Тестирование

```bash
# Тест операций с базой данных
python -c "from database import UserDatabase; db = UserDatabase(); print('База данных OK')"

# Тест движка обучения
python -c "from learning_engine import LearningEngine; le = LearningEngine(); print('Движок OK')"

# Тест API (требует настроенный .env)
python -c "from openai_api import OpenAIAPI; import asyncio; api = OpenAIAPI(); print('API OK')"
```

##  Устранение неполадок

### Частые проблемы

**Бот не запускается:**
- Проверьте наличие файла `.env` и валидность `BOT_TOKEN`
- Убедитесь в версии Python: `python --version` (должна быть 3.8+)
- Проверьте установку зависимостей: `pip install -r requirements.txt`

**GigaChat не работает:**
- Проверьте учетные данные в `.env`
- Проверьте статус GigaChat API
- Изучите логи на наличие ошибок аутентификации
- Бот будет использовать резервные упражнения, если GigaChat недоступен

**Ошибки базы данных:**
- Удалите `english_tutor.db` и перезапустите бота (БД создастся автоматически)
- Проверьте права на запись в директорию проекта

**Проблемы с кодировкой:**
- Убедитесь, что файлы сохранены в UTF-8
- В Windows используйте `chcp 65001` перед запуском

##  Безопасность

### Рекомендации

1. **Никогда не коммитьте `.env` файл** — добавьте его в `.gitignore`
2. **Используйте переменные окружения** для чувствительных данных
3. **Регулярно обновляйте зависимости**: `pip install -U -r requirements.txt`
4. **Ограничьте доступ к базе данных** — не делитесь файлом `english_tutor.db`

### Пример `.gitignore`

```gitignore
# Environment
.env
*.env

# Database
*.db
*.sqlite
*.sqlite3

# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/

# IDE
.vscode/
.idea/
*.swp
*.swo
```

## Статистика и аналитика

### Метрики пользователя

Бот отслеживает следующие метрики:

| Метрика | Описание | Использование |
|---------|----------|---------------|
| `total_exercises` | Всего упражнений | Определение уровня |
| `correct_answers` | Правильных ответов | Расчет точности |
| `accuracy` | Процент точности | Адаптация сложности |
| `weak_topics` | Слабые темы (список) | Персонализация упражнений |
| `streak_days` | Серия дней подряд | Геймификация |
| `level` | Текущий уровень | Подбор контента |

### Расширенная статистика

```python
stats = db.get_user_stats(telegram_id)
# Возвращает:
{
    "level": "intermediate",
    "accuracy": 0.75,
    "total_exercises": 45,
    "correct_answers": 34,
    "weak_topics": ["Past Perfect", "Conditionals"],
    "avg_difficulty": 0.62,
    "avg_time": 45.3,  # секунды
    "streak_days": 7
}
```

##  Roadmap

### Планируемые функции

- [ ] **Словарь пользователя** — Сохранение новых слов с примерами
- [ ] **Аудио упражнения** — Практика произношения и восприятия на слух
- [ ] **Викторины** — Тематические тесты с рейтингом
- [ ] **Напоминания** — Уведомления о ежедневных упражнениях
- [ ] **Достижения** — Система бейджей и наград
- [ ] **Групповые режимы** — Соревнования между друзьями
- [ ] **Экспорт прогресса** — Скачивание статистики в PDF/Excel
- [ ] **Мобильное приложение** — Версия для iOS/Android

